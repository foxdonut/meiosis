<!DOCTYPE html>
<html>
<head>
<title>Meiosis Documentation</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="normalize.css">
<link rel="stylesheet" href="skeleton.css">
<link rel="stylesheet" href="prism.css">
<link rel="stylesheet" href="docs.css">
</head>
<body class="container">
<script src="prism.js" type="text/javascript"></script>
<script src="flems.html" type="text/javascript" charset="utf-8"></script>
<div class="lesson">
<h1><a href="https://meiosis.js.org/setup">meiosis-setup</a> Documentation</h1><div class="docs-nav">
  <a href="setup-ts-view-library.html"><span class="nav-prev">
        <span class="arrow">&#x2B05;</span>
        <span class="title">View Library</span>
      </span></a>
  <a class="toc" href="setup-ts-toc.html">&#x2B06; Contents</a>
  <a href="setup-ts-nested-components.html"><span class="nav-next">
        <span class="arrow">&#x27A1;</span>
        <span class="title">Nested Components</span>
      </span></a>
</div>

<h2>Services</h2><p>To set up Meiosis with Services (explained in the Meiosis Documentation:
<a href="https://meiosis.js.org/docs/08-services.html">reference</a>), use the <code>services</code> property of <code>app</code>.</p>
<p>Each service is an object with a <code>run</code> function and, optionally, an <code>onchange</code> function.
<code>meiosis-setup</code> automatically wires up services, calling <code>onchange</code> (if defined) and calling <code>run</code>
only when the value returned by <code>onchange</code> changes.</p>
<p>We can use the <code>Service</code> type for services. This will auto-suggest and validate the properties of a
service (<code>onchange</code>, <code>run</code>) and automatically type the function parameters.</p>
<pre><code class="language-ts">import { meiosisSetup } from &#39;meiosis-setup&#39;;
import { MeiosisComponent, Service } from &#39;meiosis-setup/types&#39;;

interface State {
  name: string;
  age: number;
  status: string;
  data: string;
}

const service: Service&lt;State&gt; = {
  onchange: (state) =&gt; state.age,
  // run is called only when age changes, thus avoiding infinite loops
  run: (cell) =&gt; {
    cell.update({ status: cell.state.age &gt;= 21 ? &#39;adult&#39; : &#39;minor&#39; });
  }
};

const app: MeiosisComponent&lt;State&gt; = {
  services: [service]
};

const cells = meiosisSetup&lt;State&gt;({ app });
</code></pre>
<p>If a service does not have an <code>onchange</code> function, its <code>run</code> function will be called for every state
change. Thus we must make sure to avoid an infinite loop:</p>
<pre><code class="language-ts">const service: Service&lt;State&gt; = {
  run: (cell) =&gt; {
    if (cell.state.data === undefined) {
      loadData().then(data =&gt; {
        cell.update({ data });
      })
    }
  }
}
</code></pre>
<p>Below, you can see TypeScript support for services in action:</p>
<ul>
<li>Invalid properties cannot be specified on the <code>service</code> object.</li>
<li>The <code>state</code> parameter on the <code>onchange</code> function, as well as the <code>cell</code> parameter on the <code>run</code>
function, are automatically typed.</li>
<li>An invalid service object, such as <code>{}</code>, cannot be specified in the <code>services</code> array.</li>
</ul>
<iframe src="https://stackblitz.com/github/foxdonut/meiosis/tree/master/helpers/setup/examples/snippets?embed=1&terminalHeight=0&ctl=1&view=editor&file=src/services.ts" style="width:100%;height:500px"></iframe>

<p>Services can also be nested using nested components, which we will look at next.</p>
<div class="docs-nav">
  <a href="setup-ts-view-library.html"><span class="nav-prev">
        <span class="arrow">&#x2B05;</span>
        <span class="title">View Library</span>
      </span></a>
  <a class="toc" href="setup-ts-toc.html">&#x2B06; Contents</a>
  <a href="setup-ts-nested-components.html"><span class="nav-next">
        <span class="arrow">&#x27A1;</span>
        <span class="title">Nested Components</span>
      </span></a>
</div>

<hr>
<div>
<a href="https://meiosis.js.org">Meiosis</a> is developed by foxdonut
(<a href="https://twitter.com/foxdonut00">Twitter</a> /
<a href="https://github.com/foxdonut">GitHub</a>) and is released under the MIT license.
</div>
</div>
</body>
</html>