<!DOCTYPE html>
<html>
<head>
<title>Meiosis Documentation</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="normalize.css">
<link rel="stylesheet" href="skeleton.css">
<link rel="stylesheet" href="prism.css">
<link rel="stylesheet" href="docs.css">
</head>
<body class="container">
<script src="prism.js" type="text/javascript"></script>
<script src="flems.html" type="text/javascript" charset="utf-8"></script>
<div class="lesson">
<h1><a href="https://meiosis.js.org/setup">meiosis-setup</a> Documentation</h1><div class="docs-nav">
  <a href="setup-ts-services.html"><span class="nav-prev">
        <span class="arrow">&#x2B05;</span>
        <span class="title">Services</span>
      </span></a>
  <a class="toc" href="setup-ts-toc.html">&#x2B06; Contents</a>
  <a href="setup-ts-stream-implementation.html"><span class="nav-next">
        <span class="arrow">&#x27A1;</span>
        <span class="title">Stream Implementation</span>
      </span></a>
</div>

<h2>Nested Components</h2><h3>Nested Cell TypeScript Support</h3><p><code>meiosis-setup</code> automatically sets up Meiosis with Nesting (explained in the Meiosis Documentation:
<a href="https://meiosis.js.org/docs/09-nesting.html">reference</a>), so that you can call <code>cell.nest</code> to get a
nested cell:</p>
<pre><code class="language-js">cell.nest(&#39;someProperty&#39;)
</code></pre>
<p>With TypeScript support, when entering a string within <code>nest(&#39;&#39;)</code>, auto-suggest indicates valid
properties. Moreover, specifying an invalid property results in an error.</p>
<p>Once we have a nested cell, <code>cell.state.x..</code> auto-suggested nested properties, as does
<code>cell.update({ x: ... })</code>.</p>
<p>Try experimenting with the code below.</p>
<iframe src="https://stackblitz.com/github/foxdonut/meiosis/tree/master/helpers/setup/examples/snippets?embed=1&terminalHeight=0&ctl=1&view=editor&file=src/nested-cells.ts" style="width:100%;height:500px"></iframe>

<h3>Nested Components</h3><p><code>meiosis-setup</code> also provides <strong>nested components</strong>. This conveniently combines nesting of:</p>
<ul>
<li>initial state</li>
<li>services</li>
<li>views</li>
</ul>
<p>into <strong>components</strong>. Components can operate on their <code>cell.state</code> without being &quot;aware&quot; of how their
state is nested within the application state.</p>
<p>Also, a component can be reused multiple times simply by nesting it again with a different property.</p>
<p>To specify nested components, use the <code>nested</code> property of <code>app</code>:</p>
<pre><code class="language-ts">const app:MeiosisComponent&lt;State&gt; = {
  nested: {
    ...
  }
};

const cells = meiosisSetup&lt;State&gt;({ app });
</code></pre>
<p>Within <code>nested</code>, specify properties on the application state where components will be nested. For
each property, specify an object with the same structure as an <code>app</code> object, that is, of type
<code>MeiosisComponent&lt;YourNestedState&gt;</code>, with <code>initial</code> and/or <code>services</code>. Moreover, you can also
specify a <code>view</code>, in which case you can use the type <code>MeiosisViewComponent&lt;YourNestedState&gt;</code>. For
example:</p>
<pre><code class="language-ts">interface One {
  counter: number;
}

interface Two {
  duck: string;
}

interface State {
  one: One,
  two: Two
}

const oneComponent: MeiosisComponent&lt;One&gt; = {
  initial: {
    counter: 0
  },
  services: [...]
};

const twoComponent: MeiosisViewComponent&lt;Two&gt; = {
  initial: {
    duck: &#39;yellow&#39;
  },
  view: (cell) =&gt; ...
};

const app: MeiosisComponent&lt;State&gt; = {
  nested: {
    one: oneComponent,
    two: twoComponent
  }
}
</code></pre>
<h3>Initial State</h3><p>In the example above, the initial state will be:</p>
<pre><code class="language-js">{
  one: {
    counter: 0
  },
  two: {
    duck: &#39;yellow&#39;
  }
}
</code></pre>
<h3>Services</h3><p>For the <code>onchange</code> and <code>run</code> functions of the services in <code>oneComponent</code>:</p>
<pre><code class="language-js">{
  onchange: (state) =&gt; ...
  run: (cell) =&gt; ...
}
</code></pre>
<p>The <code>state</code> passed the <code>onchange</code> function will be</p>
<pre><code class="language-js">{
  counter: 0
}
</code></pre>
<p>And <code>cell.nest(&#39;one&#39;)</code> will be passed to the <code>run</code> function.</p>
<h3>View</h3><p>To call the <code>view</code> function of <code>oneComponent</code>, use the following code from the parent view:</p>
<pre><code class="language-js">cell.nested.one.view(cell)
</code></pre>
<p>the parent view. This will automatically pass <code>cell.nest(&#39;one&#39;)</code> to the <code>view</code> function of
<code>oneComponent</code>.</p>
<h3>Passing Additional Parameters</h3><p>If you need to pass more parameters to the view, add them and they will be passed along. For
example:</p>
<pre><code class="language-js">cell.nested.one.view(cell, cell.state.loggedInUser)
</code></pre>
<p>The first parameter, <code>cell</code>, will pass the <strong>nested</strong> cell to the view. If we also need data from
the parent state, we can pass it in the additional parameters, as shown above.</p>
<h3>Updating Parent State</h3><p>Besides passing parent state to a nested component, we may sometimes need to update a parent state
property from a nested component.</p>
<p>Let&#39;s say we have a component that is nested within <code>login</code>, and we want to update the parent state
by setting the <code>loggedInUser</code> property using the <code>onLogin</code> action below:</p>
<pre><code class="language-js">const actions = {
  onLogin: (cell: MeiosisCell&lt;State&gt;, loggedInUser: string): void =&gt; {
    cell.update({ loggedInUser });
  }
};
</code></pre>
<p>Again we can simply pass an additional property to the view, this time passing a function that calls
<code>actions.onLogin</code>:</p>
<pre><code class="language-js">cell.nested.login.view(cell,
  (loggedInUser: string) =&gt; actions.onLogin(cell, loggedInUser))
</code></pre>
<p>The nested <code>login</code> view can then get <code>onLogin</code> as a parameter:</p>
<pre><code class="language-js">const login: MeiosisViewComponent&lt;Login&gt; = {
  view: (cell, onLogin: (username: string) =&gt; void) =&gt; ...
};
</code></pre>
<p>The view can then call <code>onLogin</code> at the appropriate time, passing the logged in user.</p>
<h3>Deep Nesting</h3><p>Finally, note that nested components can in turn have a <code>nested</code> property and themselves use nested
components. Thus you can nest components at deeper levels within your application.</p>
<h3>Example</h3><p>Below is an example of using nested components.</p>
<p>Notice how the <code>login</code> and <code>data</code> components can focus on their state without being &quot;aware&quot; of where
their state is nested within the application state.</p>
<p>Also note how the application view can call nested views with <code>view(cell)</code>, which will automatically
pass the nested cell to the view.</p>
<p>The <code>login</code> component shows how to update the parent state by passing an additional callback
parameter that calls `actions.onLogin.</p>
<p>The <code>data</code> component exemplifies passing parent state to the component, in this case the logged in
user.</p>
<p>Finally, you can see that the <code>data</code> component is reused as-is simply by nesting it with different
properties, <code>data1</code> and <code>data2</code>.</p>
<iframe src="https://stackblitz.com/github/foxdonut/meiosis/tree/master/helpers/setup/examples/nested-components?embed=1&terminalHeight=0&ctl=1&view=both&file=src/index.ts" style="width:100%;height:600px"></iframe>

<div class="docs-nav">
  <a href="setup-ts-services.html"><span class="nav-prev">
        <span class="arrow">&#x2B05;</span>
        <span class="title">Services</span>
      </span></a>
  <a class="toc" href="setup-ts-toc.html">&#x2B06; Contents</a>
  <a href="setup-ts-stream-implementation.html"><span class="nav-next">
        <span class="arrow">&#x27A1;</span>
        <span class="title">Stream Implementation</span>
      </span></a>
</div>

<hr>
<div>
<a href="https://meiosis.js.org">Meiosis</a> is developed by foxdonut
(<a href="https://twitter.com/foxdonut00">Twitter</a> /
<a href="https://github.com/foxdonut">GitHub</a>) and is released under the MIT license.
</div>
</div>
</body>
</html>